<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery Command Center - Multi-Game</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header h1 { color: #667eea; margin-bottom: 10px; }
        .header p { color: #666; }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .tab:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .tab.active { background: #667eea; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .main-grid {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 20px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .card h2 { color: #333; margin-bottom: 15px; font-size: 1.2em; }
        input[type="date"], input[type="number"], input[type="file"], textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        textarea { font-family: monospace; min-height: 100px; }
        .number-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px; }
        .number-grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 10px; }
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-info { background: #3b82f6; color: white; margin-bottom: 10px; }
        .btn-info:hover { background: #2563eb; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .param-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .param-group { margin-bottom: 15px; }
        .param-group label { display: block; font-size: 13px; color: #666; margin-bottom: 5px; font-weight: 500; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-card { padding: 15px; border-radius: 8px; text-align: center; }
        .stat-card.blue { background: #dbeafe; }
        .stat-card.green { background: #d1fae5; }
        .stat-card.purple { background: #e9d5ff; }
        .stat-card.orange { background: #fed7aa; }
        .stat-label { font-size: 12px; color: #666; margin-bottom: 5px; }
        .stat-value { font-size: 24px; font-weight: bold; color: #333; }
        .results-area { max-height: 400px; overflow-y: auto; }
        .combo-item {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .combo-numbers { display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
        .number-ball {
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .number-ball.star { background: #f59e0b; }
        .combo-meta { font-size: 12px; color: #666; margin-top: 5px; }
        .draw-item {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            overflow-x: auto;
        }
        .draw-content { display: flex; align-items: center; gap: 15px; flex: 1; min-width: 0; }
        .draw-date { font-size: 13px; color: #666; min-width: 100px; }
        .draw-numbers { display: flex; gap: 6px; flex-wrap: nowrap; align-items: center; }
        .draw-ball {
            width: 32px;
            height: 32px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            flex-shrink: 0;
        }
        .draw-ball.bonus { background: #dc2626; }
        .draw-ball.star { background: #f59e0b; }
        .btn-delete {
            background: #ef4444;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 12px;
        }
        .btn-delete:hover { background: #dc2626; }
        .info-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        .info-box h3 { color: #92400e; margin-bottom: 8px; font-size: 14px; }
        .info-box p { color: #78350f; font-size: 13px; line-height: 1.5; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: bold;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé∞ Multi-Game Lottery Command Center</h1>
            <p>6/49, EuroMillions (5/50+2/12) - Advanced combo analysis and generation</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('analyzer')">üìä Analyzer</div>
            <div class="tab" onclick="switchTab('workflow')">üìã Guide</div>
        </div>
        
        <!-- ANALYZER TAB -->
        <div id="analyzer" class="tab-content active">
            <div class="main-grid">
                <!-- Left Column -->
                <div class="left-column">
                    <!-- Game & Country Selection -->
                    <div class="card">
                        <h2>üéÆ Game Selection</h2>
                        <div class="param-group">
                            <label>Game Type</label>
                            <select id="gameType" onchange="changeGame()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                                <option value="649">6/49 Lottery</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                            </select>
                        </div>
                        <div class="param-group">
                            <label>Country</label>
                            <select id="countrySelect" onchange="changeCountry()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                                <option value="Canada">üá®üá¶ Canada</option>
                                <option value="Romania">üá∑üá¥ Romania</option>
                                <option value="Europe">üá™üá∫ Europe</option>
                            </select>
                        </div>
                        <p style="font-size: 12px; color: #666; margin-top: 10px;">
                            File: <strong id="currentFile">a_649_CA.txt</strong>
                        </p>
                        <button class="btn-info" onclick="autoLoadFromGitHub()">
                            üîÑ Auto-Load
                        </button>
                        <div id="autoLoadStatus" style="font-size: 12px; color: #666; margin-top: 10px;"></div>
                    </div>
                    
                    <!-- Strategy & Random Seed -->
                    <div class="card">
                        <h2>‚öôÔ∏è Strategy</h2>
                        <div class="param-group">
                            <label>Combo Strategy</label>
                            <select id="comboStrategy" onchange="changeStrategy()" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                                <option value="3">3-Combo Analysis</option>
                                <option value="4" selected>4-Combo Analysis</option>
                                <option value="5">5-Combo Analysis</option>
                            </select>
                        </div>
                        <div class="param-group">
                            <label>Random Seed</label>
                            <input type="number" id="randomSeed" value="12345" onchange="updateSeed()">
                            <p style="font-size: 11px; color: #666; margin-top: 5px;">
                                Same seed = identical results across devices
                            </p>
                        </div>
                    </div>
                    
                    <!-- Bulk Import -->
                    <div class="card">
                        <h2>üì• Bulk Import</h2>
                        <p style="font-size: 12px; color: #666; margin-bottom: 10px;" id="bulkFormatHint">
                            Format: YYMMDD: n1, n2, n3, n4, n5, n6 / bonus
                        </p>
                        <textarea id="bulkImport" placeholder=""></textarea>
                        <button class="btn-primary" onclick="importBulk()">Import</button>
                    </div>
                    
                    <!-- Add Single Draw -->
                    <div class="card">
                        <h2>üìÖ Add Draw</h2>
                        <input type="date" id="drawDate">
                        <div id="mainNumbersGrid" class="number-grid">
                            <input type="number" id="n1" min="1" placeholder="N1">
                            <input type="number" id="n2" min="1" placeholder="N2">
                            <input type="number" id="n3" min="1" placeholder="N3">
                            <input type="number" id="n4" min="1" placeholder="N4">
                            <input type="number" id="n5" min="1" placeholder="N5">
                            <input type="number" id="n6" min="1" placeholder="N6">
                        </div>
                        <div id="bonusSection">
                            <input type="number" id="bonus" min="1" placeholder="Bonus">
                        </div>
                        <button class="btn-primary" onclick="addDraw()">‚ûï Add</button>
                    </div>
                    
                    <!-- Generation -->
                    <div class="card">
                        <h2>üé≤ Generate</h2>
                        <div class="param-group">
                            <label>Tickets</label>
                            <input type="number" id="numTickets" min="1" max="1000" value="100">
                        </div>
                        <div class="param-group">
                            <label>Distance Filter</label>
                            <select id="distanceFilter" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                                <option value="3">Distance 3 ONLY</option>
                                <option value="4" selected>Distance 4 ONLY</option>
                            </select>
                        </div>
                        <div class="param-row">
                            <div class="param-group">
                                <label>Holes Min</label>
                                <input type="number" id="holeMin" min="0" max="5" value="1">
                            </div>
                            <div class="param-group">
                                <label>Holes Max</label>
                                <input type="number" id="holeMax" min="0" max="5" value="2">
                            </div>
                        </div>
                        <div class="param-row">
                            <div class="param-group">
                                <label>Odd Min</label>
                                <input type="number" id="oddMin" min="0" max="6" value="2">
                            </div>
                            <div class="param-group">
                                <label>Odd Max</label>
                                <input type="number" id="oddMax" min="0" max="6" value="4">
                            </div>
                        </div>
                        <button class="btn-success" onclick="generateTickets()" id="generateBtn">üé≤ Generate</button>
                    </div>
                    
                    <!-- Trim & Check -->
                    <div class="card">
                        <h2>‚úÇÔ∏è Trim</h2>
                        <input type="number" id="trimNumber" min="1" placeholder="Number to remove">
                        <button class="btn-warning" onclick="trimTickets()">Remove</button>
                        <div id="trimStats" style="font-size: 12px; color: #666; margin-top: 10px;"></div>
                    </div>
                    
                    <!-- Data Management -->
                    <div class="card">
                        <h2>üíæ Data</h2>
                        <button class="btn-info" onclick="exportData()">‚¨áÔ∏è Export</button>
                        <input type="file" id="importFile" accept=".json" onchange="importData()" style="display: none;">
                        <button class="btn-warning" onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è Import</button>
                    </div>
                </div>
                
                <!-- Right Column -->
                <div class="right-column">
                    <!-- Statistics -->
                    <div class="card" id="statsCard">
                        <h2 id="statsTitle">üìä 4-Combo Analysis</h2>
                        <div class="stats-grid">
                            <div class="stat-card blue">
                                <div class="stat-label">Total Draws</div>
                                <div class="stat-value" id="totalDraws">0</div>
                            </div>
                            <div class="stat-card green">
                                <div class="stat-label" id="totalCombosLabel">Total 4-Combos</div>
                                <div class="stat-value" id="totalCombos">211,876</div>
                            </div>
                            <div class="stat-card purple">
                                <div class="stat-label" id="drawnCombosLabel">Drawn 4-Combos</div>
                                <div class="stat-value" id="drawnCombos">0</div>
                            </div>
                            <div class="stat-card orange">
                                <div class="stat-label">Remaining</div>
                                <div class="stat-value" id="remainingCombos">211,876</div>
                            </div>
                        </div>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
                        </div>
                        
                        <p style="font-size: 13px; color: #666; margin-top: 10px;">
                            Coverage: <span id="coveragePercent">0.00</span>% drawn
                        </p>
                    </div>
                    
                    <!-- Generated Tickets -->
                    <div class="card" id="generatedCard" style="display: none;">
                        <h2>‚ú® Generated Tickets (<span id="genCount">0</span>)</h2>
                        <div class="results-area" id="generatedResults"></div>
                    </div>
                    
                    <!-- Historical Draws -->
                    <div class="card" id="drawsCard" style="display: none;">
                        <h2>üìú Historical Draws (<span id="drawCount">0</span>)</h2>
                        <div class="results-area" id="drawsList"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- WORKFLOW TAB -->
        <div id="workflow" class="tab-content">
            <div class="card">
                <h2>üìã Quick Guide</h2>
                <div class="info-box">
                    <h3>üöÄ Getting Started</h3>
                    <p><strong>1.</strong> Select game type (6/49 or EuroMillions)</p>
                    <p><strong>2.</strong> Select country</p>
                    <p><strong>3.</strong> Click "Auto-Load" or import draws manually</p>
                    <p><strong>4.</strong> Choose combo strategy (3, 4, or 5)</p>
                    <p><strong>5.</strong> Generate tickets</p>
                </div>
                <div class="info-box">
                    <h3>üéØ Combo Strategies</h3>
                    <p><strong>3-Combo:</strong> Less exhausted, good for new lotteries (EuroMillions)</p>
                    <p><strong>4-Combo:</strong> Balanced, default for 6/49</p>
                    <p><strong>5-Combo:</strong> More restrictive, advanced analysis</p>
                </div>
                <div class="info-box">
                    <h3>üé∞ EuroMillions</h3>
                    <p><strong>Format:</strong> 5 main numbers (1-50) + 2 stars (1-12)</p>
                    <p><strong>Import:</strong> YYMMDD: n1, n2, n3, n4, n5 / s1, s2</p>
                    <p><strong>Example:</strong> 251205: 3, 12, 18, 34, 42 / 5, 9</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game configurations
        const GAME_CONFIGS = {
            '649': {
                mainMax: 49,
                mainCount: 6,
                bonusCount: 1,
                bonusMax: 49,
                totalCombos: {3: 18424, 4: 211876, 5: 1906884}
            },
            'euromillions': {
                mainMax: 50,
                mainCount: 5,
                bonusCount: 2,
                bonusMax: 12,
                totalCombos: {3: 19600, 4: 230300, 5: 2118760}
            }
        };
        
        let currentGame = '649';
        let currentCountry = 'Canada';
        let comboSize = 4;
        let randomSeed = 12345;
        
        let draws = [];
        let generated = [];
        let drawnCombos = new Set();
        
        // Seeded Random
        class SeededRandom {
            constructor(seed) { this.seed = seed; }
            next() {
                this.seed = (this.seed * 9301 + 49297) % 233280;
                return this.seed / 233280;
            }
            nextInt(min, max) {
                return Math.floor(this.next() * (max - min + 1)) + min;
            }
            setSeed(seed) { this.seed = seed; }
        }
        const rng = new SeededRandom(randomSeed);
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        function changeGame() {
            currentGame = document.getElementById('gameType').value;
            updateGameUI();
            if (confirm(`Switch to ${currentGame === '649' ? '6/49' : 'EuroMillions'}?\n\nThis will clear current data.`)) {
                draws = [];
                generated = [];
                drawnCombos.clear();
                updateUI();
            } else {
                document.getElementById('gameType').value = currentGame === '649' ? 'euromillions' : '649';
            }
        }
        
        function updateGameUI() {
            const config = GAME_CONFIGS[currentGame];
            const isEuro = currentGame === 'euromillions';
            
            // Update country options
            const countryEl = document.getElementById('countrySelect');
            if (isEuro) {
                countryEl.innerHTML = '<option value="Europe">üá™üá∫ Europe</option>';
                currentCountry = 'Europe';
            } else {
                countryEl.innerHTML = `
                    <option value="Canada" ${currentCountry === 'Canada' ? 'selected' : ''}>üá®üá¶ Canada</option>
                    <option value="Romania" ${currentCountry === 'Romania' ? 'selected' : ''}>üá∑üá¥ Romania</option>
                `;
                if (currentCountry === 'Europe') currentCountry = 'Canada';
            }
            
            // Update file name
            const fileName = isEuro ? 'a_550_EU.txt' : 
                           (currentCountry === 'Canada' ? 'a_649_CA.txt' : 'a_649_RO.txt');
            document.getElementById('currentFile').textContent = fileName;
            
            // Update number inputs
            const mainGrid = document.getElementById('mainNumbersGrid');
            mainGrid.className = isEuro ? 'number-grid' : 'number-grid';
            mainGrid.innerHTML = '';
            for (let i = 1; i <= (isEuro ? 5 : 6); i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.id = `n${i}`;
                input.min = '1';
                input.max = config.mainMax;
                input.placeholder = `N${i}`;
                mainGrid.appendChild(input);
            }
            
            // Update bonus section
            const bonusSection = document.getElementById('bonusSection');
            if (isEuro) {
                bonusSection.innerHTML = `
                    <div class="number-grid-2">
                        <input type="number" id="star1" min="1" max="12" placeholder="Star 1">
                        <input type="number" id="star2" min="1" max="12" placeholder="Star 2">
                    </div>
                `;
            } else {
                bonusSection.innerHTML = `<input type="number" id="bonus" min="1" max="${config.mainMax}" placeholder="Bonus">`;
            }
            
            // Update bulk import hint
            document.getElementById('bulkFormatHint').textContent = isEuro ?
                'Format: YYMMDD: n1, n2, n3, n4, n5 / s1, s2' :
                'Format: YYMMDD: n1, n2, n3, n4, n5, n6 / bonus';
            
            // Update distance options
            const distEl = document.getElementById('distanceFilter');
            if (isEuro) {
                distEl.innerHTML = `
                    <option value="3">Distance 3 ONLY</option>
                    <option value="4" selected>Distance 4 ONLY</option>
                `;
            } else {
                distEl.innerHTML = `
                    <option value="3">Distance 3 ONLY</option>
                    <option value="4" selected>Distance 4 ONLY</option>
                `;
            }
            
            updateComboTotals();
        }
        
        function changeCountry() {
            currentCountry = document.getElementById('countrySelect').value;
            const isEuro = currentCountry === 'Europe';
            
            // Auto-switch game type based on country
            if (isEuro && currentGame !== 'euromillions') {
                currentGame = 'euromillions';
                document.getElementById('gameType').value = 'euromillions';
                updateGameUI();
            } else if (!isEuro && currentGame === 'euromillions') {
                currentGame = '649';
                document.getElementById('gameType').value = '649';
                updateGameUI();
            }
            
            const fileName = isEuro ? 'a_550_12_EU.txt' :
                           (currentCountry === 'Canada' ? 'a_649_CA.txt' : 'a_649_RO.txt');
            document.getElementById('currentFile').textContent = fileName;
        }
        
        function changeStrategy() {
            comboSize = parseInt(document.getElementById('comboStrategy').value);
            document.getElementById('statsTitle').textContent = `üìä ${comboSize}-Combo Analysis`;
            updateComboTotals();
            updateComboTracking();
            updateUI();
        }
        
        function updateComboTotals() {
            const config = GAME_CONFIGS[currentGame];
            const total = config.totalCombos[comboSize];
            document.getElementById('totalCombosLabel').textContent = `Total ${comboSize}-Combos`;
            document.getElementById('drawnCombosLabel').textContent = `Drawn ${comboSize}-Combos`;
            document.getElementById('totalCombos').textContent = total.toLocaleString();
            document.getElementById('remainingCombos').textContent = total.toLocaleString();
        }
        
        function updateSeed() {
            randomSeed = parseInt(document.getElementById('randomSeed').value) || 12345;
            rng.setSeed(randomSeed);
        }
        
        function getCombos(numbers, size) {
            const result = [];
            function combine(start, combo) {
                if (combo.length === size) {
                    result.push([...combo].sort((a,b) => a-b).join('-'));
                    return;
                }
                for (let i = start; i < numbers.length; i++) {
                    combo.push(numbers[i]);
                    combine(i + 1, combo);
                    combo.pop();
                }
            }
            combine(0, []);
            return result;
        }
        
        function updateComboTracking() {
            drawnCombos.clear();
            draws.forEach(draw => {
                const combos = getCombos(draw.numbers, comboSize);
                combos.forEach(combo => drawnCombos.add(combo));
            });
        }
        
        function calculateHoles(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            let holes = 0;
            for (let i = 1; i < sorted.length; i++) {
                if (sorted[i] - sorted[i-1] > 2) holes++;
            }
            return holes;
        }
        
        function calculateOdd(numbers) {
            return numbers.filter(n => n % 2 === 1).length;
        }
        
        function calculateDistance(combo, draw) {
            const comboSet = new Set(combo);
            const drawSet = new Set(draw);
            let matches = 0;
            comboSet.forEach(n => {
                if (drawSet.has(n)) matches++;
            });
            return combo.length - matches;
        }
        
        function countUndrawnCombos(numbers) {
            const combos = getCombos(numbers, comboSize);
            let undrawn = 0;
            combos.forEach(combo => {
                if (!drawnCombos.has(combo)) undrawn++;
            });
            return { total: combos.length, undrawn: undrawn };
        }
        
        function importBulk() {
            const text = document.getElementById('bulkImport').value;
            const lines = text.split('\n');
            const config = GAME_CONFIGS[currentGame];
            const isEuro = currentGame === 'euromillions';
            let imported = 0, skipped = 0;
            
            lines.forEach(line => {
                line = line.trim();
                if (!line || line.startsWith('#')) return;
                
                if (line.includes(':')) {
                    try {
                        const parts = line.split(':');
                        const dateStr = parts[0].trim();
                        const afterColon = parts[1];
                        
                        if (!afterColon || !afterColon.includes('/')) {
                            skipped++;
                            return;
                        }
                        
                        const numsPart = afterColon.split('/')[0].trim();
                        const bonusPart = afterColon.split('/')[1].trim();
                        
                        // Parse date YYMMDD to YYYY-MM-DD
                        let fullDate = '';
                        if (dateStr.length === 6 && /^\d{6}$/.test(dateStr)) {
                            const yy = dateStr.substring(0, 2);
                            const mm = dateStr.substring(2, 4);
                            const dd = dateStr.substring(4, 6);
                            const year = parseInt(yy) > 50 ? '19' + yy : '20' + yy;
                            fullDate = `${year}-${mm}-${dd}`;
                        } else {
                            skipped++;
                            return;
                        }
                        
                        const numbers = [];
                        numsPart.split(',').forEach(n => {
                            const num = parseInt(n.trim());
                            if (!isNaN(num) && num >= 1 && num <= config.mainMax) {
                                numbers.push(num);
                            }
                        });
                        
                        if (numbers.length !== config.mainCount) {
                            console.log(`Skipped line: expected ${config.mainCount} numbers, got ${numbers.length}. Line: ${line}`);
                            skipped++;
                            return;
                        }
                        
                        let bonuses = [];
                        if (isEuro) {
                            bonusPart.split(',').forEach(b => {
                                const bonus = parseInt(b.trim());
                                if (!isNaN(bonus) && bonus >= 1 && bonus <= config.bonusMax) {
                                    bonuses.push(bonus);
                                }
                            });
                            if (bonuses.length !== 2) {
                                console.log(`Skipped line: expected 2 stars, got ${bonuses.length}. Line: ${line}`);
                                skipped++;
                                return;
                            }
                        } else {
                            const bonus = parseInt(bonusPart.trim());
                            if (isNaN(bonus) || bonus < 1 || bonus > config.mainMax) {
                                console.log(`Skipped line: invalid bonus. Line: ${line}`);
                                skipped++;
                                return;
                            }
                            bonuses = [bonus];
                        }
                        
                        draws.push({
                            date: fullDate,
                            numbers: numbers,
                            bonuses: bonuses,
                            holes: calculateHoles(numbers),
                            odd: calculateOdd(numbers)
                        });
                        imported++;
                        
                    } catch (e) {
                        skipped++;
                    }
                }
            });
            
            draws.sort((a, b) => new Date(a.date) - new Date(b.date));
            updateComboTracking();
            updateUI();
            
            document.getElementById('bulkImport').value = '';
            alert(`‚úÖ Import Complete\n\nImported: ${imported}\nSkipped: ${skipped}\nTotal draws: ${draws.length}`);
        }
        
        function addDraw() {
            const config = GAME_CONFIGS[currentGame];
            const isEuro = currentGame === 'euromillions';
            const date = document.getElementById('drawDate').value;
            
            if (!date) {
                alert('Please enter a date');
                return;
            }
            
            const numbers = [];
            for (let i = 1; i <= config.mainCount; i++) {
                const num = parseInt(document.getElementById(`n${i}`).value);
                if (isNaN(num) || num < 1 || num > config.mainMax) {
                    alert(`All numbers must be between 1 and ${config.mainMax}`);
                    return;
                }
                numbers.push(num);
            }
            
            if (new Set(numbers).size !== config.mainCount) {
                alert('Numbers must be unique');
                return;
            }
            
            let bonuses = [];
            if (isEuro) {
                const s1 = parseInt(document.getElementById('star1').value);
                const s2 = parseInt(document.getElementById('star2').value);
                if (isNaN(s1) || s1 < 1 || s1 > config.bonusMax ||
                    isNaN(s2) || s2 < 1 || s2 > config.bonusMax) {
                    alert(`Stars must be between 1 and ${config.bonusMax}`);
                    return;
                }
                if (s1 === s2) {
                    alert('Stars must be unique');
                    return;
                }
                bonuses = [s1, s2];
            } else {
                const bonus = parseInt(document.getElementById('bonus').value);
                if (isNaN(bonus) || bonus < 1 || bonus > config.mainMax) {
                    alert(`Bonus must be between 1 and ${config.mainMax}`);
                    return;
                }
                bonuses = [bonus];
            }
            
            draws.push({
                date: date,
                numbers: numbers,
                bonuses: bonuses,
                holes: calculateHoles(numbers),
                odd: calculateOdd(numbers)
            });
            
            draws.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Clear inputs
            document.getElementById('drawDate').value = '';
            for (let i = 1; i <= config.mainCount; i++) {
                document.getElementById(`n${i}`).value = '';
            }
            if (isEuro) {
                document.getElementById('star1').value = '';
                document.getElementById('star2').value = '';
            } else {
                document.getElementById('bonus').value = '';
            }
            
            updateComboTracking();
            updateUI();
            alert('Draw added successfully');
        }
        
        function deleteDraw(index) {
            draws.splice(index, 1);
            updateComboTracking();
            updateUI();
        }
        
        function generateTickets() {
            if (draws.length < 10) {
                alert('Need at least 10 draws');
                return;
            }
            
            const config = GAME_CONFIGS[currentGame];
            const numTickets = parseInt(document.getElementById('numTickets').value);
            const holeMin = parseInt(document.getElementById('holeMin').value);
            const holeMax = parseInt(document.getElementById('holeMax').value);
            const oddMin = parseInt(document.getElementById('oddMin').value);
            const oddMax = parseInt(document.getElementById('oddMax').value);
            const requiredDistance = parseInt(document.getElementById('distanceFilter').value);
            
            rng.setSeed(randomSeed);
            
            const results = [];
            const maxAttempts = numTickets * 50000;
            let attempts = 0;
            
            while (results.length < numTickets && attempts < maxAttempts) {
                attempts++;
                
                const combo = [];
                while (combo.length < config.mainCount) {
                    const num = rng.nextInt(1, config.mainMax);
                    if (!combo.includes(num)) combo.push(num);
                }
                combo.sort((a, b) => a - b);
                
                const holes = calculateHoles(combo);
                const odd = calculateOdd(combo);
                
                if (holes < holeMin || holes > holeMax || odd < oddMin || odd > oddMax) continue;
                
                // Check distance from ALL draws
                let validDistance = true;
                for (const draw of draws) {
                    const dist = calculateDistance(combo, draw.numbers);
                    if (dist !== requiredDistance) {
                        validDistance = false;
                        break;
                    }
                }
                
                if (!validDistance) continue;
                if (results.some(r => r.numbers.join(',') === combo.join(','))) continue;
                
                const comboInfo = countUndrawnCombos(combo);
                
                // Generate bonuses
                let bonuses = [];
                if (currentGame === 'euromillions') {
                    while (bonuses.length < 2) {
                        const star = rng.nextInt(1, 12);
                        if (!bonuses.includes(star)) bonuses.push(star);
                    }
                    bonuses.sort((a, b) => a - b);
                } else {
                    bonuses = [rng.nextInt(1, config.mainMax)];
                }
                
                results.push({
                    numbers: combo,
                    bonuses: bonuses,
                    holes: holes,
                    odd: odd,
                    undrawn: comboInfo.undrawn,
                    total: comboInfo.total
                });
            }
            
            results.sort((a, b) => b.undrawn - a.undrawn);
            generated = results;
            updateUI();
            
            if (results.length === 0) {
                alert(`‚ö†Ô∏è No tickets found!\n\nTried ${attempts} combinations.\n\nTry relaxing constraints.`);
            } else if (results.length < numTickets) {
                alert(`‚ö†Ô∏è Generated ${results.length} tickets (wanted ${numTickets})\n\nUsing seed: ${randomSeed}\nDistance ${requiredDistance} ONLY`);
            } else {
                alert(`‚úÖ Generated ${results.length} tickets\n\nSeed: ${randomSeed}\nDistance ${requiredDistance} ONLY\nCombo size: ${comboSize}`);
            }
        }
        
        function trimTickets() {
            const trimNum = parseInt(document.getElementById('trimNumber').value);
            const config = GAME_CONFIGS[currentGame];
            
            if (isNaN(trimNum) || trimNum < 1 || trimNum > config.mainMax) {
                alert(`Enter valid number 1-${config.mainMax}`);
                return;
            }
            
            if (generated.length === 0) {
                alert('No tickets to trim');
                return;
            }
            
            const before = generated.length;
            generated = generated.filter(t => !t.numbers.includes(trimNum));
            const removed = before - generated.length;
            
            document.getElementById('trimNumber').value = '';
            document.getElementById('trimStats').innerHTML = 
                `Removed: <strong>${removed}</strong> | Remaining: <strong>${generated.length}</strong>`;
            
            updateUI();
            alert(removed > 0 ? `‚úÖ Removed ${removed} tickets` : `No tickets had ${trimNum}`);
        }
        
        function autoLoadFromGitHub() {
            const statusEl = document.getElementById('autoLoadStatus');
            statusEl.innerHTML = '‚è≥ Loading...';
            
            const isEuro = currentGame === 'euromillions';
            const fileName = isEuro ? 'lottery-data-Europe.json' :
                           `lottery-data-${currentCountry}.json`;
            const url = `https://raw.githubusercontent.com/dumitruxian/Lotto/main/${fileName}`;
            
            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error(`File not found: ${fileName}`);
                    return response.json();
                })
                .then(data => {
                    if (data.game) {
                        currentGame = data.game;
                        document.getElementById('gameType').value = currentGame;
                    }
                    if (data.country) {
                        currentCountry = data.country;
                    }
                    if (data.comboSize) {
                        comboSize = data.comboSize;
                        document.getElementById('comboStrategy').value = comboSize;
                    }
                    if (data.seed) {
                        randomSeed = data.seed;
                        document.getElementById('randomSeed').value = randomSeed;
                        rng.setSeed(randomSeed);
                    }
                    
                    // Fix old format data (migrate bonus to bonuses array)
                    if (data.draws) {
                        draws = data.draws.map(d => {
                            if (d.bonus !== undefined && !d.bonuses) {
                                return {...d, bonuses: [d.bonus]};
                            }
                            if (!d.bonuses) {
                                return {...d, bonuses: []};
                            }
                            return d;
                        });
                    }
                    
                    if (data.generated) {
                        generated = data.generated.map(g => {
                            if (g.bonus !== undefined && !g.bonuses) {
                                return {...g, bonuses: [g.bonus]};
                            }
                            if (!g.bonuses) {
                                return {...g, bonuses: []};
                            }
                            return g;
                        });
                    }
                    
                    updateGameUI();
                    document.getElementById('countrySelect').value = currentCountry;
                    updateComboTracking();
                    updateUI();
                    
                    statusEl.innerHTML = `‚úÖ Loaded<br>Draws: ${draws.length}`;
                    alert(`‚úÖ Loaded!\nGame: ${currentGame}\nDraws: ${draws.length}\nTickets: ${generated.length}`);
                })
                .catch(error => {
                    statusEl.innerHTML = `‚ùå ${error.message}`;
                    alert(`‚ùå Failed to load\n\n${error.message}`);
                });
        }
        
        function exportData() {
            const isEuro = currentGame === 'euromillions';
            const fileName = isEuro ? 'lottery-data-Europe.json' :
                           `lottery-data-${currentCountry}.json`;
            const data = {
                game: currentGame,
                country: currentCountry,
                comboSize: comboSize,
                seed: randomSeed,
                draws: draws,
                generated: generated
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            alert(`‚úÖ Exported ${fileName}`);
        }
        
        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.game) {
                        currentGame = data.game;
                        document.getElementById('gameType').value = currentGame;
                    }
                    if (data.country) {
                        currentCountry = data.country;
                    }
                    if (data.comboSize) {
                        comboSize = data.comboSize;
                        document.getElementById('comboStrategy').value = comboSize;
                    }
                    if (data.seed) {
                        randomSeed = data.seed;
                        document.getElementById('randomSeed').value = randomSeed;
                        rng.setSeed(randomSeed);
                    }
                    
                    // Fix old format data (migrate bonus to bonuses array)
                    if (data.draws) {
                        draws = data.draws.map(d => {
                            if (d.bonus !== undefined && !d.bonuses) {
                                return {...d, bonuses: [d.bonus]};
                            }
                            if (!d.bonuses) {
                                return {...d, bonuses: []};
                            }
                            return d;
                        });
                    }
                    
                    if (data.generated) {
                        generated = data.generated.map(g => {
                            if (g.bonus !== undefined && !g.bonuses) {
                                return {...g, bonuses: [g.bonus]};
                            }
                            if (!g.bonuses) {
                                return {...g, bonuses: []};
                            }
                            return g;
                        });
                    }
                    
                    updateGameUI();
                    document.getElementById('countrySelect').value = currentCountry;
                    updateComboTracking();
                    updateUI();
                    alert(`‚úÖ Imported!\nGame: ${currentGame}\nCombo: ${comboSize}\nDraws: ${draws.length}\nTickets: ${generated.length}`);
                } catch (err) {
                    alert('Invalid file: ' + err.message);
                }
            };
            reader.readAsText(file);
            document.getElementById('importFile').value = '';
        }
        
        function updateStats() {
            const config = GAME_CONFIGS[currentGame];
            const drawnCount = drawnCombos.size;
            const totalCount = config.totalCombos[comboSize];
            const remaining = totalCount - drawnCount;
            const percentage = totalCount > 0 ? (drawnCount / totalCount * 100).toFixed(2) : '0.00';
            
            document.getElementById('totalDraws').textContent = draws.length;
            document.getElementById('totalCombos').textContent = totalCount.toLocaleString();
            document.getElementById('drawnCombos').textContent = drawnCount.toLocaleString();
            document.getElementById('remainingCombos').textContent = remaining.toLocaleString();
            document.getElementById('coveragePercent').textContent = percentage;
            
            const bar = document.getElementById('progressBar');
            bar.style.width = percentage + '%';
            bar.textContent = percentage + '%';
        }
        
        function updateUI() {
            updateStats();
            
            const config = GAME_CONFIGS[currentGame];
            const isEuro = currentGame === 'euromillions';
            
            document.getElementById('genCount').textContent = generated.length;
            document.getElementById('drawCount').textContent = draws.length;
            
            // Update generated tickets
            if (generated.length > 0) {
                document.getElementById('generatedCard').style.display = 'block';
                document.getElementById('generatedResults').innerHTML = generated.map((t, i) => {
                    let minDist = 100;
                    draws.forEach(draw => {
                        const dist = calculateDistance(t.numbers, draw.numbers);
                        if (dist < minDist) minDist = dist;
                    });
                    
                    const mainBalls = t.numbers.map(n => `<div class="number-ball">${n}</div>`).join('');
                    const bonusBalls = t.bonuses.map(b => 
                        `<div class="number-ball ${isEuro ? 'star' : ''}">${b}</div>`
                    ).join('');
                    
                    return `
                        <div class="combo-item">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <div style="font-weight: bold; color: #667eea; font-size: 16px;">#${i + 1}</div>
                                <div class="combo-meta">
                                    Undrawn ${comboSize}-combos: ${t.undrawn}/${t.total} | 
                                    Dist: ${minDist} | H: ${t.holes} | O: ${t.odd}
                                </div>
                            </div>
                            <div class="combo-numbers">
                                ${mainBalls}
                                ${bonusBalls}
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                document.getElementById('generatedCard').style.display = 'none';
            }
            
            // Update draws list
            if (draws.length > 0) {
                document.getElementById('drawsCard').style.display = 'block';
                
                let html = '';
                for (let i = draws.length - 1; i >= 0; i--) {
                    const d = draws[i];
                    const numbers = d.numbers || [];
                    const bonusArray = d.bonuses || [];
                    
                    html += '<div class="draw-item" style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">';
                    html += '<div style="display: flex; align-items: center; gap: 15px; flex: 1;">';
                    html += `<div style="font-size: 13px; color: #666; min-width: 100px;">${d.date}</div>`;
                    html += '<div style="display: flex; gap: 6px; align-items: center;">';
                    
                    // Main numbers
                    for (let j = 0; j < numbers.length; j++) {
                        html += `<div style="width: 32px; height: 32px; background: #3b82f6; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">${numbers[j]}</div>`;
                    }
                    
                    // Bonus/Stars
                    for (let k = 0; k < bonusArray.length; k++) {
                        const bgColor = isEuro ? '#f59e0b' : '#dc2626';
                        html += `<div style="width: 32px; height: 32px; background: ${bgColor}; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">${bonusArray[k]}</div>`;
                    }
                    
                    html += '</div></div>';
                    html += `<button class="btn-delete" onclick="deleteDraw(${i})">üóëÔ∏è</button>`;
                    html += '</div>';
                }
                
                document.getElementById('drawsList').innerHTML = html;
                console.log('Rendered', draws.length, 'draws with inline styles');
            } else {
                console.log('No draws to display');
                document.getElementById('drawsCard').style.display = 'none';
            }
            
            document.getElementById('generateBtn').disabled = draws.length < 10;
        }
        
        // Initialize
        updateGameUI();
        updateUI();
    </script>
</body>
</html>