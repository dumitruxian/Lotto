<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery Command Center v51 - Multi-Game</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header h1 { color: #667eea; margin-bottom: 10px; }
        .header p { color: #666; }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .tab:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .tab.active { background: #667eea; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .main-grid {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 20px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .card h2 { color: #333; margin-bottom: 15px; font-size: 1.2em; }
        input[type="date"], input[type="number"], input[type="file"], textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        textarea { font-family: monospace; min-height: 100px; }
        .number-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px; }
        .number-grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 10px; }
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-info { background: #3b82f6; color: white; margin-bottom: 10px; }
        .btn-info:hover { background: #2563eb; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .param-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .param-group { margin-bottom: 15px; }
        .param-group label { display: block; font-size: 13px; color: #666; margin-bottom: 5px; font-weight: 500; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-card { padding: 15px; border-radius: 8px; text-align: center; }
        .stat-card.blue { background: #dbeafe; }
        .stat-card.green { background: #d1fae5; }
        .stat-card.purple { background: #e9d5ff; }
        .stat-card.orange { background: #fed7aa; }
        .stat-label { font-size: 12px; color: #666; margin-bottom: 5px; }
        .stat-value { font-size: 24px; font-weight: bold; color: #333; }
        .results-area { max-height: 400px; overflow-y: auto; }
        .combo-item {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .combo-numbers { display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
        .number-ball {
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .number-ball.star { background: #f59e0b; }
        .combo-meta { font-size: 12px; color: #666; margin-top: 5px; }
        .draw-item {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            overflow-x: auto;
        }
        .draw-content { display: flex; align-items: center; gap: 15px; flex: 1; min-width: 0; }
        .draw-date { font-size: 13px; color: #666; min-width: 100px; }
        .draw-numbers { display: flex; gap: 6px; flex-wrap: nowrap; align-items: center; }
        .draw-ball {
            width: 32px;
            height: 32px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            flex-shrink: 0;
        }
        .draw-ball.bonus { background: #dc2626; }
        .draw-ball.star { background: #f59e0b; }
        .btn-delete {
            background: #ef4444;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 12px;
        }
        .btn-delete:hover { background: #dc2626; }
        .info-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        .info-box h3 { color: #92400e; margin-bottom: 8px; font-size: 14px; }
        .info-box p { color: #78350f; font-size: 13px; line-height: 1.5; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: bold;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé∞ Multi-Game Lottery Command Center v51</h1>
            <p>6/49, EuroMillions (5/50+2/12) - Advanced combo analysis and generation</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('analyzer')">üìä Analyzer</div>
            <div class="tab" onclick="switchTab('workflow')">üìã Guide</div>
        </div>
        
        <!-- ANALYZER TAB -->
        <div id="analyzer" class="tab-content active">
            <div class="main-grid">
                <!-- Left Column -->
                <div class="left-column">
                    <!-- Game & Country Selection -->
                    <div class="card">
                        <h2>üéÆ Game Selection</h2>
                        <div class="param-group">
                            <label>Game Type</label>
                            <select id="gameType" onchange="changeGame()">
                                <option value="649">6/49 Lottery</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                            </select>
                        </div>
                        <div class="param-group">
                            <label>Country</label>
                            <select id="countrySelect" onchange="changeCountry()">
                                <option value="Canada">üá®üá¶ Canada (with bonus)</option>
                                <option value="Romania">üá∑üá¥ Romania (no bonus)</option>
                                <option value="Europe">üá™üá∫ Europe</option>
                            </select>
                        </div>
                        <p style="font-size: 12px; color: #666; margin-top: 10px;">
                            File: <strong id="currentFile">a_649_CA.txt</strong>
                        </p>
                        <button class="btn-info" onclick="autoLoadFromGitHub()">
                            üîÑ Auto-Load
                        </button>
                        <div id="autoLoadStatus" style="font-size: 12px; color: #666; margin-top: 10px;"></div>
                    </div>
                    
                    <!-- Strategy & Random Seed -->
                    <div class="card">
                        <h2>‚öôÔ∏è Strategy</h2>
                        <div class="param-group">
                            <label>Combo Strategy</label>
                            <select id="comboStrategy" onchange="changeStrategy()">
                                <option value="3">3-Combo Analysis</option>
                                <option value="4" selected>4-Combo Analysis</option>
                                <option value="5">5-Combo Analysis</option>
                            </select>
                        </div>
                        <div class="param-group">
                            <label>Random Seed</label>
                            <input type="number" id="randomSeed" value="12345" onchange="updateSeed()">
                            <p style="font-size: 11px; color: #666; margin-top: 5px;">
                                Same seed = identical results across devices
                            </p>
                        </div>
                    </div>
                    
                    <!-- Bulk Import -->
                    <div class="card">
                        <h2>üì• Bulk Import</h2>
                        <p style="font-size: 12px; color: #666; margin-bottom: 10px;" id="bulkFormatHint">
                            Format: YYMMDD: n1, n2, n3, n4, n5, n6 / bonus
                        </p>
                        <textarea id="bulkImport" placeholder=""></textarea>
                        <button class="btn-primary" onclick="importBulk()">Import</button>
                    </div>
                    
                    <!-- Add Single Draw -->
                    <div class="card">
                        <h2>üìÖ Add Draw</h2>
                        <input type="date" id="drawDate">
                        <div id="mainNumbersGrid" class="number-grid">
                            <input type="number" id="n1" min="1" placeholder="N1">
                            <input type="number" id="n2" min="1" placeholder="N2">
                            <input type="number" id="n3" min="1" placeholder="N3">
                            <input type="number" id="n4" min="1" placeholder="N4">
                            <input type="number" id="n5" min="1" placeholder="N5">
                            <input type="number" id="n6" min="1" placeholder="N6">
                        </div>
                        <div id="bonusSection">
                            <input type="number" id="bonus" min="1" placeholder="Bonus">
                        </div>
                        <button class="btn-primary" onclick="addDraw()">‚ûï Add</button>
                    </div>
                    
                    <!-- Generation -->
                    <div class="card">
                        <h2>üé≤ Generate</h2>
                        <div class="param-group">
                            <label>Tickets</label>
                            <input type="number" id="numTickets" min="1" max="1000" value="100">
                        </div>
                        <div class="param-group">
                            <label>Distance Filter</label>
                            <select id="distanceFilter">
                                <option value="3">Distance 3 ONLY</option>
                                <option value="4" selected>Distance 4 ONLY</option>
                                <option value="0">No Distance Filter</option>
                            </select>
                        </div>
                        <div class="param-group">
                            <label>Check Against</label>
                            <select id="checkDraws">
                                <option value="10">Last 10 draws</option>
                                <option value="20">Last 20 draws</option>
                                <option value="50">Last 50 draws</option>
                                <option value="0">All draws</option>
                            </select>
                        </div>
                        <div class="param-row">
                            <div class="param-group">
                                <label>Holes Min</label>
                                <input type="number" id="holeMin" min="0" max="5" value="1">
                            </div>
                            <div class="param-group">
                                <label>Holes Max</label>
                                <input type="number" id="holeMax" min="0" max="5" value="2">
                            </div>
                        </div>
                        <div class="param-row">
                            <div class="param-group">
                                <label>Odd Min</label>
                                <input type="number" id="oddMin" min="0" max="6" value="2">
                            </div>
                            <div class="param-group">
                                <label>Odd Max</label>
                                <input type="number" id="oddMax" min="0" max="6" value="4">
                            </div>
                        </div>
                        <button class="btn-success" onclick="generateTickets()" id="generateBtn">üé≤ Generate</button>
                    </div>
                    
                    <!-- Check Tickets Against Last Draw -->
                    <div class="card">
                        <h2>üéØ Check Last Draw</h2>
                        <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                            Check generated tickets against the most recent draw
                        </p>
                        <div id="lastDrawDisplay" style="background: #f0f9ff; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-size: 12px; color: #666;">
                            No draws loaded yet
                        </div>
                        <button class="btn-success" onclick="checkAgainstLastDraw()">üîç Check Winners</button>
                        <div id="checkLastResults" style="font-size: 12px; margin-top: 10px;"></div>
                    </div>
                    
                    <!-- Trim & Export Played -->
                    <div class="card">
                        <h2>‚úÇÔ∏è Trim</h2>
                        <input type="number" id="trimNumber" min="1" placeholder="Number to remove">
                        <button class="btn-warning" onclick="trimTickets()">Remove</button>
                        <div id="trimStats" style="font-size: 12px; color: #666; margin-top: 10px;"></div>
                    </div>
                    
                    <!-- Export Played -->
                    <div class="card">
                        <h2>üìã Export Played</h2>
                        <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                            Save generated tickets to Play file
                        </p>
                        <button class="btn-success" onclick="exportPlayed()">üíæ Export Tickets</button>
                    </div>
                    
                    <!-- Data Management -->
                    <div class="card">
                        <h2>üíæ Data</h2>
                        <button class="btn-info" onclick="exportData()">‚¨áÔ∏è Export</button>
                        <input type="file" id="importFile" accept=".json" onchange="importData()" style="display: none;">
                        <button class="btn-warning" onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è Import</button>
                    </div>
                </div>
                
                <!-- Right Column -->
                <div class="right-column">
                    <!-- Statistics -->
                    <div class="card" id="statsCard">
                        <h2 id="statsTitle">üìä 4-Combo Analysis</h2>
                        <div class="stats-grid">
                            <div class="stat-card blue">
                                <div class="stat-label">Total Draws</div>
                                <div class="stat-value" id="totalDraws">0</div>
                            </div>
                            <div class="stat-card green">
                                <div class="stat-label" id="totalCombosLabel">Total 4-Combos</div>
                                <div class="stat-value" id="totalCombos">211,876</div>
                            </div>
                            <div class="stat-card purple">
                                <div class="stat-label" id="drawnCombosLabel">Drawn 4-Combos</div>
                                <div class="stat-value" id="drawnCombos">0</div>
                            </div>
                            <div class="stat-card orange">
                                <div class="stat-label">Remaining</div>
                                <div class="stat-value" id="remainingCombos">211,876</div>
                            </div>
                        </div>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
                        </div>
                        
                        <p style="font-size: 13px; color: #666; margin-top: 10px;">
                            Coverage: <span id="coveragePercent">0.00</span>% drawn
                        </p>
                    </div>
                    
                    <!-- Generated Tickets -->
                    <div class="card" id="generatedCard" style="display: none;">
                        <h2>‚ú® Generated Tickets (<span id="genCount">0</span>)</h2>
                        <div class="results-area" id="generatedResults"></div>
                    </div>
                    
                    <!-- Historical Draws -->
                    <div class="card" id="drawsCard" style="display: none;">
                        <h2>üìú Historical Draws (<span id="drawCount">0</span>)</h2>
                        <div class="results-area" id="drawsList"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- WORKFLOW TAB -->
        <div id="workflow" class="tab-content">
            <div class="card">
                <h2>üìã Complete Guide</h2>
                
                <div class="info-box">
                    <h3>üéÆ Game Selection</h3>
                    <p><strong>Game Type:</strong> Choose between 6/49 or EuroMillions (5/50+2/12)</p>
                    <p><strong>Country:</strong> Canada/Romania for 6/49, Europe for EuroMillions</p>
                    <p><strong>Auto-Load:</strong> Fetches data from GitHub repository automatically</p>
                </div>
                
                <div class="info-box">
                    <h3>üìä Combo Strategy</h3>
                    <p><strong>What it means:</strong> Tracks X-number combinations from historical draws</p>
                    <p><strong>3-Combo Analysis:</strong> Tracks all 3-number combinations (19,600 for EuroMillions, 18,424 for 6/49)</p>
                    <p><strong>4-Combo Analysis:</strong> DEFAULT - Tracks all 4-number combinations (230,300 for EuroMillions, 211,876 for 6/49)</p>
                    <p><strong>5-Combo Analysis:</strong> Tracks all 5-number combinations (2,118,760 for EuroMillions, 1,906,884 for 6/49)</p>
                    <p><strong>Purpose:</strong> Shows which combinations are "undrawn" (never appeared in any historical draw)</p>
                    <p><strong>Best for:</strong> 3-combo for new lotteries (fewer draws), 4-combo balanced, 5-combo advanced</p>
                </div>
                
                <div class="info-box">
                    <h3>üé≤ Generation Parameters</h3>
                    
                    <p><strong>Random Seed:</strong> Number that controls randomness. Same seed + same data = identical tickets on all devices. Change seed to get different ticket sets.</p>
                    
                    <p><strong>Distance Filter:</strong></p>
                    <p>‚Ä¢ <strong>No Distance Filter:</strong> No restrictions, easiest to generate tickets</p>
                    <p>‚Ä¢ <strong>Distance 3 ONLY:</strong> Each ticket must differ from checked draws by EXACTLY 3 numbers (shares 3 numbers)</p>
                    <p>‚Ä¢ <strong>Distance 4 ONLY:</strong> Each ticket must differ from checked draws by EXACTLY 4 numbers (shares 2 numbers)</p>
                    <p><em>Example: If draw is [5,12,23,31,42,45] and ticket is [5,12,18,27,33,38], they share 2 numbers (5,12) so distance = 4</em></p>
                    
                    <p><strong>Check Against:</strong></p>
                    <p>‚Ä¢ <strong>Last 10/20/50 draws:</strong> Only checks distance against recent draws (faster, more results)</p>
                    <p>‚Ä¢ <strong>All draws:</strong> Checks distance against entire history (stricter, fewer results)</p>
                    
                    <p><strong>Holes:</strong> Number of "interval gaps" in the ticket</p>
                    <p>‚Ä¢ <strong>Intervals:</strong> 1-9, 10-19, 20-29, 30-39, 40-49</p>
                    <p>‚Ä¢ <strong>Hole = Missing interval:</strong> If ticket has no numbers in an interval, that's 1 hole</p>
                    <p>‚Ä¢ <strong>Example:</strong> Ticket [3,12,23,35,42,48] has numbers in 1-9(3), 10-19(12), 20-29(23), 30-39(35), 40-49(42,48) = 0 holes (all intervals covered)</p>
                    <p>‚Ä¢ <strong>Example:</strong> Ticket [5,8,25,28,42,45] has numbers in 1-9(5,8), 20-29(25,28), 40-49(42,45) = 2 holes (missing 10-19 and 30-39)</p>
                    <p>‚Ä¢ <strong>Typical:</strong> Min=1, Max=2 (allows 1-2 missing intervals)</p>
                    
                    <p><strong>Odd Min/Max:</strong> How many odd numbers in the ticket</p>
                    <p>‚Ä¢ <strong>Odd numbers:</strong> 1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49</p>
                    <p>‚Ä¢ <strong>Even numbers:</strong> 2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48</p>
                    <p>‚Ä¢ <strong>Example:</strong> Ticket [5,12,23,31,42,45] has 4 odd (5,23,31,45) and 2 even (12,42)</p>
                    <p>‚Ä¢ <strong>Typical:</strong> Min=2, Max=4 (balanced distribution)</p>
                </div>
                
                <div class="info-box">
                    <h3>‚ú® Understanding Generated Tickets</h3>
                    <p><strong>Display Format:</strong> #N | Undrawn X-combos: A/B | Dist: C | H: D | O: E</p>
                    
                    <p><strong>#N:</strong> Ticket number (1-100)</p>
                    
                    <p><strong>Undrawn X-combos: A/B:</strong></p>
                    <p>‚Ä¢ <strong>X:</strong> Combo strategy you selected (3, 4, or 5)</p>
                    <p>‚Ä¢ <strong>A:</strong> How many X-number combos in this ticket are UNDRAWN (never appeared in history)</p>
                    <p>‚Ä¢ <strong>B:</strong> Total possible X-number combos in this ticket</p>
                    <p>‚Ä¢ <strong>Example "Undrawn 3-combos: 8/10":</strong></p>
                    <p>&nbsp;&nbsp;- This ticket contains 10 different 3-number combinations</p>
                    <p>&nbsp;&nbsp;- 8 of them have NEVER appeared in any historical draw</p>
                    <p>&nbsp;&nbsp;- 2 of them HAVE appeared before</p>
                    <p>‚Ä¢ <strong>Why it matters:</strong> Higher A = more "fresh" combinations that haven't been drawn</p>
                    <p>‚Ä¢ <strong>Best tickets:</strong> Highest A/B ratio (e.g., 15/15 = all undrawn!)</p>
                    
                    <p><strong>Dist: C:</strong> Minimum distance from ALL historical draws</p>
                    <p>‚Ä¢ Shows how different this ticket is from every draw in history</p>
                    <p>‚Ä¢ Higher = more different from past draws</p>
                    <p>‚Ä¢ This is NOT the same as the combo strategy number!</p>
                    
                    <p><strong>H: D:</strong> Number of holes (missing intervals)</p>
                    <p><strong>O: E:</strong> Number of odd numbers</p>
                </div>
                
                <div class="info-box">
                    <h3>üéØ Check Last Draw</h3>
                    <p><strong>Purpose:</strong> Automatically checks all generated tickets against the most recent draw</p>
                    <p><strong>Shows:</strong> How many tickets won prizes (6 match, 5+bonus, 5 match, 4 match, 3 match)</p>
                    <p><strong>Use case:</strong> Simulation testing - see how well your strategy performs</p>
                </div>
                
                <div class="info-box">
                    <h3>üìã Export Played Tickets</h3>
                    <p><strong>Purpose:</strong> Save generated tickets as a text file for actual play</p>
                    <p><strong>Format:</strong> Play_CA.txt (Canada), Play_RO.txt (Romania), Play_EU.txt (Europe)</p>
                    <p><strong>Auto-save:</strong> Files are automatically prepared when you click "Generate" and saved to browser storage</p>
                    <p><strong>Manual export:</strong> Click "Export Tickets" button to download the file</p>
                    <p><strong>Use case:</strong> Take this file to lottery retailer or track which tickets you bought</p>
                    <p><strong>Check against draws:</strong> Use "Check Last Draw" to verify your Play file tickets against new draws</p>
                </div>
                
                <div class="info-box">
                    <h3>üí° Recommended Workflow</h3>
                    <p><strong>1.</strong> Select game and country ‚Üí Auto-load data</p>
                    <p><strong>2.</strong> Choose combo strategy (4-combo recommended)</p>
                    <p><strong>3.</strong> Set generation parameters:</p>
                    <p>&nbsp;&nbsp;‚Ä¢ Start with "No Distance Filter" + "Last 10 draws"</p>
                    <p>&nbsp;&nbsp;‚Ä¢ Holes: 1-2, Odd: 2-4</p>
                    <p><strong>4.</strong> Generate 100 tickets (auto-creates Play file)</p>
                    <p><strong>5.</strong> Review tickets (look for high undrawn combos)</p>
                    <p><strong>6.</strong> Trim unwanted numbers if needed</p>
                    <p><strong>7.</strong> Export played tickets ‚Üí Upload to GitHub manually</p>
                    <p><strong>8.</strong> After draw: Check winners against last draw</p>
                </div>
                
                <div class="info-box">
                    <h3>üé∞ EuroMillions Specifics</h3>
                    <p><strong>Format:</strong> 5 main numbers (1-50) + 2 stars (1-12)</p>
                    <p><strong>Import:</strong> YYMMDD: n1, n2, n3, n4, n5 / s1, s2</p>
                    <p><strong>Example:</strong> 251205: 3, 12, 18, 34, 42 / 5, 9</p>
                    <p><strong>Stars:</strong> Always unique (star 1 ‚â† star 2)</p>
                    <p><strong>Combo strategy:</strong> Applies only to main 5 numbers, not stars</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game configurations
        const GAME_CONFIGS = {
            '649': {
                mainMax: 49,
                mainCount: 6,
                bonusCount: 1,
                bonusMax: 49,
                totalCombos: {3: 18424, 4: 211876, 5: 1906884},
                hasBonus: true
            },
            'euromillions': {
                mainMax: 50,
                mainCount: 5,
                bonusCount: 2,
                bonusMax: 12,
                totalCombos: {3: 19600, 4: 230300, 5: 2118760},
                hasBonus: true
            }
        };
        
        let currentGame = '649';
        let currentCountry = 'Canada';
        let comboSize = 4;
        let randomSeed = 12345;
        
        let draws = [];
        let generated = [];
        let drawnCombos = new Set();
        
        // Seeded Random
        class SeededRandom {
            constructor(seed) { this.seed = seed; }
            next() {
                this.seed = (this.seed * 9301 + 49297) % 233280;
                return this.seed / 233280;
            }
            nextInt(min, max) {
                return Math.floor(this.next() * (max - min + 1)) + min;
            }
            setSeed(seed) { this.seed = seed; }
        }
        const rng = new SeededRandom(randomSeed);
        
        // Load saved settings from localStorage
        function loadSettings() {
            try {
                const saved = localStorage.getItem('lotterySettings');
                if (saved) {
                    const settings = JSON.parse(saved);
                    if (settings.holeMin !== undefined) document.getElementById('holeMin').value = settings.holeMin;
                    if (settings.holeMax !== undefined) document.getElementById('holeMax').value = settings.holeMax;
                    if (settings.oddMin !== undefined) document.getElementById('oddMin').value = settings.oddMin;
                    if (settings.oddMax !== undefined) document.getElementById('oddMax').value = settings.oddMax;
                    if (settings.randomSeed !== undefined) {
                        randomSeed = settings.randomSeed;
                        document.getElementById('randomSeed').value = randomSeed;
                        rng.setSeed(randomSeed);
                    }
                    if (settings.comboSize !== undefined) {
                        comboSize = settings.comboSize;
                        document.getElementById('comboStrategy').value = comboSize;
                    }
                }
            } catch (e) {
                console.log('Could not load settings:', e);
            }
        }
        
        // Save settings to localStorage
        function saveSettings() {
            try {
                const settings = {
                    holeMin: parseInt(document.getElementById('holeMin').value),
                    holeMax: parseInt(document.getElementById('holeMax').value),
                    oddMin: parseInt(document.getElementById('oddMin').value),
                    oddMax: parseInt(document.getElementById('oddMax').value),
                    randomSeed: randomSeed,
                    comboSize: comboSize
                };
                localStorage.setItem('lotterySettings', JSON.stringify(settings));
            } catch (e) {
                console.log('Could not save settings:', e);
            }
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        function changeGame() {
            currentGame = document.getElementById('gameType').value;
            updateGameUI();
            if (confirm(`Switch to ${currentGame === '649' ? '6/49' : 'EuroMillions'}?\n\nThis will clear current data.`)) {
                draws = [];
                generated = [];
                drawnCombos.clear();
                updateUI();
            } else {
                document.getElementById('gameType').value = currentGame === '649' ? 'euromillions' : '649';
            }
        }
        
        function updateGameUI() {
            const config = GAME_CONFIGS[currentGame];
            const isEuro = currentGame === 'euromillions';
            
            // Update country options
            const countryEl = document.getElementById('countrySelect');
            if (isEuro) {
                countryEl.innerHTML = '<option value="Europe">üá™üá∫ Europe</option>';
                currentCountry = 'Europe';
            } else {
                countryEl.innerHTML = `
                    <option value="Canada" ${currentCountry === 'Canada' ? 'selected' : ''}>üá®üá¶ Canada</option>
                    <option value="Romania" ${currentCountry === 'Romania' ? 'selected' : ''}>üá∑üá¥ Romania</option>
                `;
                if (currentCountry === 'Europe') currentCountry = 'Canada';
            }
            
            // Update file name
            const fileName = isEuro ? 'a_550_12_EU.txt' : 
                           (currentCountry === 'Canada' ? 'a_649_CA.txt' : 'a_649_RO.txt');
            document.getElementById('currentFile').textContent = fileName;
            
            // Update number inputs - FIX: Romania should have 6 numbers
            const mainGrid = document.getElementById('mainNumbersGrid');
            mainGrid.className = 'number-grid';
            mainGrid.innerHTML = '';
            const numCount = isEuro ? 5 : 6; // 6/49 always has 6 numbers regardless of country
            for (let i = 1; i <= numCount; i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.id = `n${i}`;
                input.min = '1';
                input.max = config.mainMax;
                input.placeholder = `N${i}`;
                mainGrid.appendChild(input);
            }
            
            // Update bonus section
            const bonusSection = document.getElementById('bonusSection');
            if (isEuro) {
                bonusSection.innerHTML = `
                    <div class="number-grid-2">
                        <input type="number" id="star1" min="1" max="12" placeholder="Star 1">
                        <input type="number" id="star2" min="1" max="12" placeholder="Star 2">
                    </div>
                `;
            } else {
                bonusSection.innerHTML = `<input type="number" id="bonus" min="1" max="${config.mainMax}" placeholder="Bonus">`;
            }
            
            // Update bulk import hint
            document.getElementById('bulkFormatHint').textContent = isEuro ?
                'Format: YYMMDD: n1, n2, n3, n4, n5 / s1, s2' :
                'Format: YYMMDD: n1, n2, n3, n4, n5, n6 / bonus';
            
            // Update distance options
            const distEl = document.getElementById('distanceFilter');
            distEl.innerHTML = `
                <option value="0">No Distance Filter</option>
                <option value="3">Distance 3 ONLY</option>
                <option value="4" selected>Distance 4 ONLY</option>
            `;
            
            updateComboTotals();
        }
        
        function changeCountry() {
            currentCountry = document.getElementById('countrySelect').value;
            const isEuro = currentCountry === 'Europe';
            const hasBonus = currentCountry !== 'Romania';
            
            // Update config
            if (currentGame === '649') {
                GAME_CONFIGS['649'].hasBonus = hasBonus;
            }
            
            // Auto-switch game type based on country
            if (isEuro && currentGame !== 'euromillions') {
                currentGame = 'euromillions';
                document.getElementById('gameType').value = 'euromillions';
                updateGameUI();
            } else if (!isEuro && currentGame === 'euromillions') {
                currentGame = '649';
                document.getElementById('gameType').value = '649';
                updateGameUI();
            } else {
                // Just update bonus section
                updateBonusSection();
            }
            
            const fileName = isEuro ? 'a_550_12_EU.txt' : 
                           (currentCountry === 'Canada' ? 'a_649_CA.txt' : 'a_649_RO.txt');
            document.getElementById('currentFile').textContent = fileName;
        }
        
        function updateBonusSection() {
            const config = GAME_CONFIGS[currentGame];
            const hasBonus = currentCountry !== 'Romania'; // Romania has no bonus
            const bonusSection = document.getElementById('bonusSection');
            
            if (currentGame === 'euromillions') {
                bonusSection.innerHTML = `
                    <div class="number-grid-2">
                        <input type="number" id="star1" min="1" max="12" placeholder="Star 1">
                        <input type="number" id="star2" min="1" max="12" placeholder="Star 2">
                    </div>
                `;
            } else if (hasBonus) {
                bonusSection.innerHTML = `<input type="number" id="bonus" min="1" max="${config.mainMax}" placeholder="Bonus">`;
            } else {
                bonusSection.innerHTML = `<p style="font-size: 12px; color: #666;">No bonus number for Romania</p>`;
            }
        }
        
        function changeStrategy() {
            comboSize = parseInt(document.getElementById('comboStrategy').value);
            document.getElementById('statsTitle').textContent = `üìä ${comboSize}-Combo Analysis`;
            updateComboTotals();
            updateComboTracking();
            updateUI();
            saveSettings();
        }
        
        function updateComboTotals() {
            const config = GAME_CONFIGS[currentGame];
            const total = config.totalCombos[comboSize];
            document.getElementById('totalCombosLabel').textContent = `Total ${comboSize}-Combos`;
            document.getElementById('drawnCombosLabel').textContent = `Drawn ${comboSize}-Combos`;
            document.getElementById('totalCombos').textContent = total.toLocaleString();
            document.getElementById('remainingCombos').textContent = total.toLocaleString();
        }
        
        function updateSeed() {
            randomSeed = parseInt(document.getElementById('randomSeed').value) || 12345;
            rng.setSeed(randomSeed);
            saveSettings();
        }
        
        function getCombos(numbers, size) {
            const result = [];
            function combine(start, combo) {
                if (combo.length === size) {
                    result.push([...combo].sort((a,b) => a-b).join('-'));
                    return;
                }
                for (let i = start; i < numbers.length; i++) {
                    combo.push(numbers[i]);
                    combine(i + 1, combo);
                    combo.pop();
                }
            }
            combine(0, []);
            return result;
        }
        
        function updateComboTracking() {
            drawnCombos.clear();
            draws.forEach(draw => {
                const combos = getCombos(draw.numbers, comboSize);
                combos.forEach(combo => drawnCombos.add(combo));
            });
        }
        
        function calculateHoles(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            let holes = 0;
            for (let i = 1; i < sorted.length; i++) {
                if (sorted[i] - sorted[i-1] > 2) holes++;
            }
            return holes;
        }
        
        function calculateOdd(numbers) {
            return numbers.filter(n => n % 2 === 1).length;
        }
        
        function calculateDistance(combo, draw) {
            const comboSet = new Set(combo);
            const drawSet = new Set(draw);
            let matches = 0;
            comboSet.forEach(n => {
                if (drawSet.has(n)) matches++;
            });
            return combo.length - matches;
        }
        
        function countUndrawnCombos(numbers) {
            const combos = getCombos(numbers, comboSize);
            let undrawn = 0;
            combos.forEach(combo => {
                if (!drawnCombos.has(combo)) undrawn++;
            });
            return { total: combos.length, undrawn: undrawn };
        }
        
        function importBulk() {
            const text = document.getElementById('bulkImport').value;
            const lines = text.split('\n');
            const config = GAME_CONFIGS[currentGame];
            const isEuro = currentGame === 'euromillions';
            let imported = 0, skipped = 0;
            
            lines.forEach(line => {
                line = line.trim();
                if (!line || line.startsWith('#')) return;
                
                if (line.includes(':')) {
                    try {
                        const parts = line.split(':');
                        const dateStr = parts[0].trim();
                        const afterColon = parts[1];
                        
                        if (!afterColon || !afterColon.includes('/')) {
                            skipped++;
                            return;
                        }
                        
                        const numsPart = afterColon.split('/')[0].trim();
                        const bonusPart = afterColon.split('/')[1].trim();
                        
                        // Parse date YYMMDD to YYYY-MM-DD
                        let fullDate = '';
                        if (dateStr.length === 6 && /^\d{6}$/.test(dateStr)) {
                            const yy = dateStr.substring(0, 2);
                            const mm = dateStr.substring(2, 4);
                            const dd = dateStr.substring(4, 6);
                            const year = parseInt(yy) > 50 ? '19' + yy : '20' + yy;
                            fullDate = `${year}-${mm}-${dd}`;
                        } else {
                            skipped++;
                            return;
                        }
                        
                        const numbers = [];
                        numsPart.split(',').forEach(n => {
                            const num = parseInt(n.trim());
                            if (!isNaN(num) && num >= 1 && num <= config.mainMax) {
                                numbers.push(num);
                            }
                        });
                        
                        if (numbers.length !== config.mainCount) {
                            console.log(`Skipped line: expected ${config.mainCount} numbers, got ${numbers.length}. Line: ${line}`);
                            skipped++;
                            return;
                        }
                        
                        let bonuses = [];
                        if (isEuro) {
                            bonusPart.split(',').forEach(b => {
                                const bonus = parseInt(b.trim());
                                if (!isNaN(bonus) && bonus >= 1 && bonus <= config.bonusMax) {
                                    bonuses.push(bonus);
                                }
                            });
                            if (bonuses.length !== 2) {
                                console.log(`Skipped line: expected 2 stars, got ${bonuses.length}. Line: ${line}`);
                                skipped++;
                                return;
                            }
                        } else {
                            const bonus = parseInt(bonusPart.trim());
                            if (isNaN(bonus) || bonus < 1 || bonus > config.mainMax) {
                                console.log(`Skipped line: invalid bonus. Line: ${line}`);
                                skipped++;
                                return;
                            }
                            bonuses = [bonus];
                        }
                        
                        draws.push({
                            date: fullDate,
                            numbers: numbers,
                            bonuses: bonuses,
                            holes: calculateHoles(numbers),
                            odd: calculateOdd(numbers)
                        });
                        imported++;
                        
                    } catch (e) {
                        skipped++;
                    }
                }
            });
            
            draws.sort((a, b) => new Date(a.date) - new Date(b.date));
            updateComboTracking();
            updateUI();
            
            document.getElementById('bulkImport').value = '';
            alert(`‚úÖ Import Complete\n\nImported: ${imported}\nSkipped: ${skipped}\nTotal draws: ${draws.length}`);
        }
        
        function addDraw() {
            const config = GAME_CONFIGS[currentGame];
            const isEuro = currentGame === 'euromillions';
            const date = document.getElementById('drawDate').value;
            
            if (!date) {
                alert('Please enter a date');
                return;
            }
            
            const numbers = [];
            for (let i = 1; i <= config.mainCount; i++) {
                const num = parseInt(document.getElementById(`n${i}`).value);
                if (isNaN(num) || num < 1 || num > config.mainMax) {
                    alert(`All numbers must be between 1 and ${config.mainMax}`);
                    return;
                }
                numbers.push(num);
            }
            
            if (new Set(numbers).size !== config.mainCount) {
                alert('Numbers must be unique');
                return;
            }
            
            let bonuses = [];
            if (isEuro) {
                const s1 = parseInt(document.getElementById('star1').value);
                const s2 = parseInt(document.getElementById('star2').value);
                if (isNaN(s1) || s1 < 1 || s1 > config.bonusMax ||
                    isNaN(s2) || s2 < 1 || s2 > config.bonusMax) {
                    alert(`Stars must be between 1 and ${config.bonusMax}`);
                    return;
                }
                if (s1 === s2) {
                    alert('Stars must be unique');
                    return;
                }
                bonuses = [s1, s2];
            } else {
                const bonus = parseInt(document.getElementById('bonus').value);
                if (isNaN(bonus) || bonus < 1 || bonus > config.mainMax) {
                    alert(`Bonus must be between 1 and ${config.mainMax}`);
                    return;
                }
                bonuses = [bonus];
            }
            
            draws.push({
                date: date,
                numbers: numbers,
                bonuses: bonuses,
                holes: calculateHoles(numbers),
                odd: calculateOdd(numbers)
            });
            
            draws.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Clear inputs
            document.getElementById('drawDate').value = '';
            for (let i = 1; i <= config.mainCount; i++) {
                document.getElementById(`n${i}`).value = '';
            }
            if (isEuro) {
                document.getElementById('star1').value = '';
                document.getElementById('star2').value = '';
            } else {
                document.getElementById('bonus').value = '';
            }
            
            updateComboTracking();
            updateUI();
            alert('Draw added successfully');
        }
        
        function deleteDraw(index) {
            draws.splice(index, 1);
            updateComboTracking();
            updateUI();
        }
        
        function generateTickets() {
            if (draws.length < 10) {
                alert('Need at least 10 draws');
                return;
            }
            
            const config = GAME_CONFIGS[currentGame];
            const numTickets = parseInt(document.getElementById('numTickets').value);
            const holeMin = parseInt(document.getElementById('holeMin').value);
            const holeMax = parseInt(document.getElementById('holeMax').value);
            const oddMin = parseInt(document.getElementById('oddMin').value);
            const oddMax = parseInt(document.getElementById('oddMax').value);
            const requiredDistance = parseInt(document.getElementById('distanceFilter').value);
            const checkDrawsCount = parseInt(document.getElementById('checkDraws').value);
            
            rng.setSeed(randomSeed);
            
            const results = [];
            const maxAttempts = numTickets * 50000;
            let attempts = 0;
            
            // Get draws to check against
            const drawsToCheck = checkDrawsCount === 0 ? draws : draws.slice(-checkDrawsCount);
            const useDistance = requiredDistance > 0;
            
            console.log(`Generating with: holes ${holeMin}-${holeMax}, odd ${oddMin}-${oddMax}, distance ${requiredDistance}, checking ${drawsToCheck.length} draws`);
            
            while (results.length < numTickets && attempts < maxAttempts) {
                attempts++;
                
                const combo = [];
                while (combo.length < config.mainCount) {
                    const num = rng.nextInt(1, config.mainMax);
                    if (!combo.includes(num)) combo.push(num);
                }
                combo.sort((a, b) => a - b);
                
                const holes = calculateHoles(combo);
                const odd = calculateOdd(combo);
                
                if (holes < holeMin || holes > holeMax) continue;
                if (odd < oddMin || odd > oddMax) continue;
                
                // Check distance only if enabled
                if (useDistance) {
                    let validDistance = true;
                    for (const draw of drawsToCheck) {
                        const dist = calculateDistance(combo, draw.numbers);
                        if (dist !== requiredDistance) {
                            validDistance = false;
                            break;
                        }
                    }
                    if (!validDistance) continue;
                }
                
                if (results.some(r => r.numbers.join(',') === combo.join(','))) continue;
                
                const comboInfo = countUndrawnCombos(combo);
                
                // Generate bonuses
                let bonuses = [];
                if (currentGame === 'euromillions') {
                    while (bonuses.length < 2) {
                        const star = rng.nextInt(1, 12);
                        if (!bonuses.includes(star)) bonuses.push(star);
                    }
                    bonuses.sort((a, b) => a - b);
                } else {
                    bonuses = [rng.nextInt(1, config.mainMax)];
                }
                
                results.push({
                    numbers: combo,
                    bonuses: bonuses,
                    holes: holes,
                    odd: odd,
                    undrawn: comboInfo.undrawn,
                    total: comboInfo.total
                });
            }
            
            results.sort((a, b) => b.undrawn - a.undrawn);
            generated = results;
            
            // Auto-save to Play file
            if (results.length > 0) {
                savePlayFileToLocalStorage(results);
            }
            
            updateUI();
            
            const distText = useDistance ? 
                `Distance ${requiredDistance} against ${drawsToCheck.length} draws` : 
                'No distance filter';
            
            if (results.length === 0) {
                alert(`‚ö†Ô∏è No tickets found!\n\nTried ${attempts.toLocaleString()} combinations.\n\n${distText}\nHoles: ${holeMin}-${holeMax}\nOdd: ${oddMin}-${oddMax}\n\nTry:\n‚Ä¢ Disable distance filter\n‚Ä¢ Relax hole/odd constraints\n‚Ä¢ Check fewer draws`);
            } else if (results.length < numTickets) {
                alert(`‚ö†Ô∏è Generated ${results.length} tickets (wanted ${numTickets})\n\nSeed: ${randomSeed}\n${distText}\nHoles: ${holeMin}-${holeMax}\nOdd: ${oddMin}-${oddMax}`);
            } else {
                alert(`‚úÖ Generated ${results.length} tickets\n\nSeed: ${randomSeed}\n${distText}\nCombo: ${comboSize}-combos\n\nPlay file saved to browser storage!`);
            }
        }
        
        function trimTickets() {
            const trimNum = parseInt(document.getElementById('trimNumber').value);
            const config = GAME_CONFIGS[currentGame];
            
            if (isNaN(trimNum) || trimNum < 1 || trimNum > config.mainMax) {
                alert(`Enter valid number 1-${config.mainMax}`);
                return;
            }
            
            if (generated.length === 0) {
                alert('No tickets to trim');
                return;
            }
            
            const before = generated.length;
            generated = generated.filter(t => !t.numbers.includes(trimNum));
            const removed = before - generated.length;
            
            document.getElementById('trimNumber').value = '';
            document.getElementById('trimStats').innerHTML = 
                `Removed: <strong>${removed}</strong> | Remaining: <strong>${generated.length}</strong>`;
            
            updateUI();
            alert(removed > 0 ? `‚úÖ Removed ${removed} tickets` : `No tickets had ${trimNum}`);
        }
        
        function checkAgainstLastDraw() {
            if (draws.length === 0) {
                alert('No draws loaded');
                return;
            }
            
            if (generated.length === 0) {
                alert('No tickets generated. Generate tickets first.');
                return;
            }
            
            const lastDraw = draws[draws.length - 1];
            const config = GAME_CONFIGS[currentGame];
            const isEuro = currentGame === 'euromillions';
            
            // Display last draw
            const mainBalls = lastDraw.numbers.map(n => `[${n}]`).join(' ');
            const bonusBalls = lastDraw.bonuses.map(b => isEuro ? `‚≠ê${b}` : `üî¥${b}`).join(' ');
            document.getElementById('lastDrawDisplay').innerHTML = 
                `<strong>Last Draw (${lastDraw.date}):</strong><br>${mainBalls} ${bonusBalls}`;
            
            // Check each ticket
            const results = {
                '6': [], '5+bonus': [], '5': [], '4': [], '3': [], '2': [], '1': [], '0': []
            };
            
            if (isEuro) {
                results['5+2stars'] = [];
                results['5+1star'] = [];
                delete results['5+bonus'];
            }
            
            generated.forEach((ticket, index) => {
                const ticketSet = new Set(ticket.numbers);
                const drawSet = new Set(lastDraw.numbers);
                let mainMatches = 0;
                
                ticketSet.forEach(num => {
                    if (drawSet.has(num)) mainMatches++;
                });
                
                if (isEuro) {
                    // Check star matches
                    const ticketStars = new Set(ticket.bonuses);
                    const drawStars = new Set(lastDraw.bonuses);
                    let starMatches = 0;
                    ticketStars.forEach(star => {
                        if (drawStars.has(star)) starMatches++;
                    });
                    
                    if (mainMatches === 5 && starMatches === 2) {
                        results['5+2stars'].push(index + 1);
                    } else if (mainMatches === 5 && starMatches === 1) {
                        results['5+1star'].push(index + 1);
                    } else if (mainMatches === 5) {
                        results['5'].push(index + 1);
                    } else if (mainMatches === 4) {
                        results['4'].push(index + 1);
                    } else if (mainMatches === 3) {
                        results['3'].push(index + 1);
                    } else if (mainMatches === 2) {
                        results['2'].push(index + 1);
                    } else if (mainMatches === 1) {
                        results['1'].push(index + 1);
                    } else {
                        results['0'].push(index + 1);
                    }
                } else {
                    // 6/49 logic
                    const hasBonus = ticket.bonuses.some(b => lastDraw.bonuses.includes(b));
                    
                    if (mainMatches === 6) {
                        results['6'].push(index + 1);
                    } else if (mainMatches === 5 && hasBonus) {
                        results['5+bonus'].push(index + 1);
                    } else if (mainMatches === 5) {
                        results['5'].push(index + 1);
                    } else if (mainMatches === 4) {
                        results['4'].push(index + 1);
                    } else if (mainMatches === 3) {
                        results['3'].push(index + 1);
                    } else if (mainMatches === 2) {
                        results['2'].push(index + 1);
                    } else if (mainMatches === 1) {
                        results['1'].push(index + 1);
                    } else {
                        results['0'].push(index + 1);
                    }
                }
            });
            
            // Display results
            let html = '<div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 10px;">';
            html += '<strong>Results:</strong><br><br>';
            
            const prizes = isEuro ? {
                '5+2stars': 'üèÜ 5+2 Stars',
                '5+1star': 'üíé 5+1 Star',
                '5': 'üéÅ 5 Match',
                '4': 'üéØ 4 Match',
                '3': 'üé´ 3 Match'
            } : {
                '6': 'üèÜ JACKPOT',
                '5+bonus': 'üíé 5+Bonus',
                '5': 'üéÅ 5 Match',
                '4': 'üéØ 4 Match',
                '3': 'üé´ 3 Match'
            };
            
            let hasWinners = false;
            for (const [key, label] of Object.entries(prizes)) {
                if (results[key] && results[key].length > 0) {
                    hasWinners = true;
                    html += `<div style="margin-bottom: 5px; color: #059669;">`;
                    html += `<strong>${label}:</strong> ${results[key].length} ticket(s)`;
                    if (results[key].length <= 20) {
                        html += ` - #${results[key].join(', #')}`;
                    }
                    html += '</div>';
                }
            }
            
            if (!hasWinners) {
                html += '<div style="color: #666;">No winning tickets (3+ matches)</div>';
            }
            
            html += '</div>';
            document.getElementById('checkLastResults').innerHTML = html;
            
            // Summary alert
            const winningTickets = Object.keys(prizes).reduce((sum, key) => 
                sum + (results[key] ? results[key].length : 0), 0);
            
            if (winningTickets > 0) {
                let alertMsg = `üéâ Found ${winningTickets} winning tickets!\n\n`;
                Object.keys(prizes).forEach(key => {
                    if (results[key] && results[key].length > 0) {
                        alertMsg += `${prizes[key]}: ${results[key].length}\n`;
                    }
                });
                alert(alertMsg);
            } else {
                alert('No winning tickets found (no 3+ matches)');
            }
        }
        
        function exportPlayed() {
            if (generated.length === 0) {
                alert('No tickets to export. Generate tickets first.');
                return;
            }
            
            const isEuro = currentGame === 'euromillions';
            let fileName;
            
            // Determine file name based on game and country
            if (isEuro) {
                fileName = 'Play_EU.txt';
            } else if (currentCountry === 'Romania') {
                fileName = 'Play_RO.txt';
            } else if (currentCountry === 'Canada') {
                fileName = 'Play_CA.txt';
            } else {
                fileName = 'Play_649.txt';
            }
            
            const content = generatePlayFileContent();
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            
            alert(`‚úÖ Exported ${generated.length} tickets to ${fileName}`);
        }
        
        function generatePlayFileContent() {
            const isEuro = currentGame === 'euromillions';
            
            let content = `# Played Tickets - ${currentGame === 'euromillions' ? 'EuroMillions' : '6/49'}\n`;
            content += `# Country: ${currentCountry}\n`;
            content += `# Generated: ${new Date().toISOString().split('T')[0]}\n`;
            content += `# Total tickets: ${generated.length}\n`;
            content += `# Seed: ${randomSeed}\n`;
            content += `# Combo Strategy: ${comboSize}-combos\n`;
            content += `#\n`;
            
            if (isEuro) {
                content += `# Format: N1, N2, N3, N4, N5 / Star1, Star2\n#\n`;
                generated.forEach((ticket, i) => {
                    const mainNums = ticket.numbers.map(n => String(n).padStart(2, ' ')).join(', ');
                    const stars = ticket.bonuses.join(', ');
                    content += `${mainNums} / ${stars}\n`;
                });
            } else {
                content += `# Format: N1, N2, N3, N4, N5, N6 / Bonus\n#\n`;
                generated.forEach((ticket, i) => {
                    const nums = ticket.numbers.map(n => String(n).padStart(2, ' ')).join(', ');
                    const bonusStr = ticket.bonuses.length > 0 ? ` / ${ticket.bonuses[0]}` : '';
                    content += `${nums}${bonusStr}\n`;
                });
            }
            
            return content;
        }
        
        function savePlayFileToLocalStorage(tickets) {
            try {
                const isEuro = currentGame === 'euromillions';
                let fileName;
                
                // Determine file name based on game and country
                if (isEuro) {
                    fileName = 'Play_EU.txt';
                } else if (currentCountry === 'Romania') {
                    fileName = 'Play_RO.txt';
                } else if (currentCountry === 'Canada') {
                    fileName = 'Play_CA.txt';
                } else {
                    fileName = 'Play_649.txt';
                }
                
                const content = generatePlayFileContent();
                
                // Save to localStorage as backup
                localStorage.setItem(`playFile_${fileName}`, content);
                
                console.log(`‚úÖ Play file ${fileName} prepared with ${tickets.length} tickets`);
                console.log('File saved to browser localStorage.');
                
            } catch (error) {
                console.error('Error preparing play file:', error);
            }
        }
        
        function autoLoadFromGitHub() {
            const statusEl = document.getElementById('autoLoadStatus');
            statusEl.innerHTML = '‚è≥ Loading...';
            
            const isEuro = currentGame === 'euromillions';
            const fileName = isEuro ? 'lottery-data-Europe.json' :
                           `lottery-data-${currentCountry}.json`;
            const url = `https://raw.githubusercontent.com/dumitruxian/Lotto/main/${fileName}`;
            
            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error(`File not found: ${fileName}`);
                    return response.json();
                })
                .then(data => {
                    if (data.game) {
                        currentGame = data.game;
                        document.getElementById('gameType').value = currentGame;
                    }
                    if (data.country) {
                        currentCountry = data.country;
                    }
                    if (data.comboSize) {
                        comboSize = data.comboSize;
                        document.getElementById('comboStrategy').value = comboSize;
                    }
                    if (data.seed) {
                        randomSeed = data.seed;
                        document.getElementById('randomSeed').value = randomSeed;
                        rng.setSeed(randomSeed);
                    }
                    
                    // Fix old format data (migrate bonus to bonuses array)
                    if (data.draws) {
                        draws = data.draws.map(d => {
                            // Romania has no bonus, keep bonuses as empty array
                            if (currentCountry === 'Romania' || data.country === 'Romania') {
                                return {...d, bonuses: []};
                            }
                            if (d.bonus !== undefined && !d.bonuses) {
                                return {...d, bonuses: [d.bonus]};
                            }
                            if (!d.bonuses) {
                                return {...d, bonuses: []};
                            }
                            return d;
                        });
                    }
                    
                    if (data.generated) {
                        generated = data.generated.map(g => {
                            if (g.bonus !== undefined && !g.bonuses) {
                                return {...g, bonuses: [g.bonus]};
                            }
                            if (!g.bonuses) {
                                return {...g, bonuses: []};
                            }
                            return g;
                        });
                    }
                    
                    updateGameUI();
                    document.getElementById('countrySelect').value = currentCountry;
                    updateComboTracking();
                    updateUI();
                    
                    statusEl.innerHTML = `‚úÖ Loaded<br>Draws: ${draws.length}`;
                    alert(`‚úÖ Loaded!\nGame: ${currentGame}\nDraws: ${draws.length}\nTickets: ${generated.length}`);
                })
                .catch(error => {
                    statusEl.innerHTML = `‚ùå ${error.message}`;
                    alert(`‚ùå Failed to load\n\n${error.message}`);
                });
        }
        
        function exportData() {
            const isEuro = currentGame === 'euromillions';
            const fileName = isEuro ? 'lottery-data-Europe.json' :
                           `lottery-data-${currentCountry}.json`;
            const data = {
                game: currentGame,
                country: currentCountry,
                comboSize: comboSize,
                seed: randomSeed,
                draws: draws,
                generated: generated
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            alert(`‚úÖ Exported ${fileName}`);
        }
        
        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.game) {
                        currentGame = data.game;
                        document.getElementById('gameType').value = currentGame;
                    }
                    if (data.country) {
                        currentCountry = data.country;
                    }
                    if (data.comboSize) {
                        comboSize = data.comboSize;
                        document.getElementById('comboStrategy').value = comboSize;
                    }
                    if (data.seed) {
                        randomSeed = data.seed;
                        document.getElementById('randomSeed').value = randomSeed;
                        rng.setSeed(randomSeed);
                    }
                    
                    // Fix old format data (migrate bonus to bonuses array)
                    if (data.draws) {
                        draws = data.draws.map(d => {
                            // Romania has no bonus, keep bonuses as empty array
                            if (currentCountry === 'Romania' || data.country === 'Romania') {
                                return {...d, bonuses: []};
                            }
                            if (d.bonus !== undefined && !d.bonuses) {
                                return {...d, bonuses: [d.bonus]};
                            }
                            if (!d.bonuses) {
                                return {...d, bonuses: []};
                            }
                            return d;
                        });
                    }
                    
                    if (data.generated) {
                        generated = data.generated.map(g => {
                            if (g.bonus !== undefined && !g.bonuses) {
                                return {...g, bonuses: [g.bonus]};
                            }
                            if (!g.bonuses) {
                                return {...g, bonuses: []};
                            }
                            return g;
                        });
                    }
                    
                    updateGameUI();
                    document.getElementById('countrySelect').value = currentCountry;
                    updateComboTracking();
                    updateUI();
                    alert(`‚úÖ Imported!\nGame: ${currentGame}\nCombo: ${comboSize}\nDraws: ${draws.length}\nTickets: ${generated.length}`);
                } catch (err) {
                    alert('Invalid file: ' + err.message);
                }
            };
            reader.readAsText(file);
            document.getElementById('importFile').value = '';
        }
        
        function updateStats() {
            const config = GAME_CONFIGS[currentGame];
            const drawnCount = drawnCombos.size;
            const totalCount = config.totalCombos[comboSize];
            const remaining = totalCount - drawnCount;
            const percentage = totalCount > 0 ? (drawnCount / totalCount * 100).toFixed(2) : '0.00';
            
            document.getElementById('totalDraws').textContent = draws.length;
            document.getElementById('totalCombos').textContent = totalCount.toLocaleString();
            document.getElementById('drawnCombos').textContent = drawnCount.toLocaleString();
            document.getElementById('remainingCombos').textContent = remaining.toLocaleString();
            document.getElementById('coveragePercent').textContent = percentage;
            
            const bar = document.getElementById('progressBar');
            bar.style.width = percentage + '%';
            bar.textContent = percentage + '%';
        }
        
        function updateUI() {
            updateStats();
            
            const config = GAME_CONFIGS[currentGame];
            const isEuro = currentGame === 'euromillions';
            
            document.getElementById('genCount').textContent = generated.length;
            document.getElementById('drawCount').textContent = draws.length;
            
            // Update generated tickets
            if (generated.length > 0) {
                document.getElementById('generatedCard').style.display = 'block';
                document.getElementById('generatedResults').innerHTML = generated.map((t, i) => {
                    let minDist = 100;
                    draws.forEach(draw => {
                        const dist = calculateDistance(t.numbers, draw.numbers);
                        if (dist < minDist) minDist = dist;
                    });
                    
                    const mainBalls = t.numbers.map(n => `<div class="number-ball">${n}</div>`).join('');
                    const bonusBalls = t.bonuses.map(b => 
                        `<div class="number-ball ${isEuro ? 'star' : ''}">${b}</div>`
                    ).join('');
                    
                    return `
                        <div class="combo-item">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <div style="font-weight: bold; color: #667eea; font-size: 16px;">#${i + 1}</div>
                                <div class="combo-meta">
                                    Undrawn ${comboSize}-combos: ${t.undrawn}/${t.total} | 
                                    Dist: ${minDist} | H: ${t.holes} | O: ${t.odd}
                                </div>
                            </div>
                            <div class="combo-numbers">
                                ${mainBalls}
                                ${bonusBalls}
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                document.getElementById('generatedCard').style.display = 'none';
            }
            
            // Update draws list
            if (draws.length > 0) {
                document.getElementById('drawsCard').style.display = 'block';
                
                let html = '';
                for (let i = draws.length - 1; i >= 0; i--) {
                    const d = draws[i];
                    const numbers = d.numbers || [];
                    const bonusArray = d.bonuses || [];
                    
                    html += '<div class="draw-item">';
                    html += '<div class="draw-content">';
                    html += `<div class="draw-date">${d.date}</div>`;
                    html += '<div class="draw-numbers">';
                    
                    // Main numbers
                    for (let j = 0; j < numbers.length; j++) {
                        html += `<div class="draw-ball">${numbers[j]}</div>`;
                    }
                    
                    // Bonus/Stars - only show if exists and not Romania
                    if (bonusArray && bonusArray.length > 0 && currentCountry !== 'Romania') {
                        for (let k = 0; k < bonusArray.length; k++) {
                            const className = isEuro ? 'draw-ball star' : 'draw-ball bonus';
                            html += `<div class="${className}">${bonusArray[k]}</div>`;
                        }
                    }
                    
                    html += '</div></div>';
                    html += `<button class="btn-delete" onclick="deleteDraw(${i})">üóëÔ∏è</button>`;
                    html += '</div>';
                }
                
                document.getElementById('drawsList').innerHTML = html;
            } else {
                document.getElementById('drawsCard').style.display = 'none';
            }
            
            document.getElementById('generateBtn').disabled = draws.length < 10;
        }
        
        // Initialize
        loadSettings();
        updateGameUI();
        updateUI();
        
        // Save settings when inputs change
        ['holeMin', 'holeMax', 'oddMin', 'oddMax'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.addEventListener('change', saveSettings);
        });
    </script>
</body>
</html>